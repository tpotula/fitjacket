{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard | FitJacket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'accounts/style.css' %}" />
</head>
<body class="dashboard-layout">

<!-- SIDEBAR -->
<div class="sidebar d-flex flex-column p-3">

  <!-- User Info -->
  <div class="d-flex align-items-center gap-3 mb-4">
    <div class="sidebar-avatar">
      {{ request.user.username|first|upper }}
    </div>
    <div>
      <div class="sidebar-username">{{ request.user.username }}</div>
      <div class="text-muted small">{{ profile.level|capfirst }}</div>
    </div>
  </div>

  <!-- Groups -->
  <div class="sidebar-section-title">Fitness</div>
  <a href="{% url 'workouts_home' %}" class="sidebar-link">Workouts</a>
  <a href="#" class="sidebar-link">View Progress</a>
  <a href="#" class="sidebar-link">Set Reminders</a>

  <div class="sidebar-section-title">Wellness</div>
  <a href="#" class="sidebar-link">Track Nutrition</a>
  <a href="{% url 'injury_log' %}" class="sidebar-link">Log Injuries</a>
  <a href="#" class="sidebar-link">AI Workout Planner</a>

  <div class="sidebar-section-title">Community</div>
  <a href="{% url 'challenges:list' %}" class="sidebar-link">Join Challenges</a>
  <a href="#" class="sidebar-link">Profile</a>

  <div class="sidebar-footer mt-4">
    <div class="form-check form-switch mb-3">
      <input class="form-check-input" type="checkbox" id="darkModeToggle">
      <label class="form-check-label text-muted" for="darkModeToggle">Dark Mode</label>
    </div>
    <a href="{% url 'logout' %}" class="btn btn-outline-danger w-100">Logout</a>
  </div>
</div>
<!-- END SIDEBAR -->

<!-- MAIN CONTENT -->
<div class="main-content">
  <div class="container py-4">

    <!-- Header -->
    <div class="text-center mb-4">
      <h2 class="fw-bold text-primary">Fit Jacket</h2>
    </div>

    <!-- Summary & Weekly -->
    <div class="row g-4 mb-4">
      <div class="col-lg-4">
        <div class="card shadow-sm p-4 h-100 text-center">
          <h5 class="mb-3">Today's Summary</h5>
          <p class="mb-1"><strong>Steps:</strong> 6,843</p>
          <p class="mb-1"><strong>Calories Burned:</strong> 450</p>
          <p class="mb-1"><strong>Workout Duration:</strong> 45 min</p>
        </div>
      </div>
      <div class="col-lg-8">
        <div class="card shadow-sm p-4 h-100">
          <h5 class="mb-3">Weekly Activity</h5>
          <div class="bg-light rounded text-center py-5 h-100 d-flex align-items-center justify-content-center">
            <em class="text-muted">Weekly Activity Graph Placeholder</em>
          </div>
        </div>
      </div>
    </div>

    <!-- Monthly Goal Progress -->
    <div class="row justify-content-center mb-4">
      <div class="col-lg-8">
        <div class="card shadow-sm p-4 text-center">
          <h5 class="mb-3">Monthly Goal Progress</h5>
          <div class="progress" style="height: 20px;">
            <div class="progress-bar bg-primary ps-2"
              role="progressbar"
              style="width: {{ progress_percent }}%;"
              aria-valuenow="{{ workouts_count }}"
              aria-valuemin="0"
              aria-valuemax="{{ monthly_goal }}">
              {{ workouts_count }} of {{ monthly_goal }} Workouts
          </div>
        </div>
      </div>
    </div>

    <!-- Reminders & Ongoing Challenges -->
    <div class="row g-4 mb-4">
      <!-- Reminders -->
      <div class="col-md-6">
        <div class="card shadow-sm p-4 h-100">
          <h5 class="mb-3">Reminders</h5>
          <ul class="list-unstyled mb-0">
            <li>• Workout at 6 PM</li>
            <li>• Drink 2L Water</li>
            <li>• Log today's meals</li>
          </ul>
        </div>
      </div>

      <!-- Ongoing Challenges -->
      <div class="col-md-6">
        <div class="card shadow-sm p-4 h-100">
          <h5 class="mb-3">Ongoing Challenges</h5>
          {% for p in ongoing_challenges %}
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>{{ p.challenge.title }}</span>
            <form method="post" action="{% url 'challenges:complete' p.id %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-success">Complete</button>
            </form>
          </div>
          {% empty %}
          <p>No ongoing challenges. <a href="{% url 'challenges:list' %}">Browse →</a></p>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Tip of the Day -->
    <div class="text-center mt-4">
      <span class="badge bg-warning text-dark">Tip of the Day</span>
      <p class="text-muted mt-2">Stay consistent, not perfect. Small steps daily lead to big results.</p>
    </div>

    <!-- Footer -->
    <footer class="text-center text-muted py-4 small mt-5">
      © 2025 FitJacket — Build the best version of yourself.
    </footer>

  </div>
</div>
<!-- END MAIN CONTENT -->

<!-- Dark Mode Script -->
<script>
  const toggle = document.getElementById('darkModeToggle');
  const html = document.body;

  function applyDarkMode(enabled) {
    if (enabled) html.classList.add('dark-mode');
    else html.classList.remove('dark-mode');
  }

  toggle.addEventListener('change', () => {
    const enabled = toggle.checked;
    localStorage.setItem('darkMode', enabled);
    applyDarkMode(enabled);
  });

  const isDark = localStorage.getItem('darkMode') === 'true';
  toggle.checked = isDark;
  applyDarkMode(isDark);
</script>
</body>
</html>